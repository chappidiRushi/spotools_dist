import{X as ye}from"./chunk-4RLKZL7N.js";import{$a as pe,Mb as fe,U as ae,_a as ce,a as h,b as T,c as we,ca as oe,e as a,eb as le,f as V,jb as ue,na as ie,oa as ne,ob as he,pb as me,pc as J,qb as de}from"./chunk-DNTZKGKC.js";var be={APP_NAME:"Spotools",BASE_URL:"http://localhost:3000",PLAYLIST_WARN_SIZE:500},W;function xe(){return W===void 0&&(W=ce(!1)),W}var c=class{api;constructor(e){this.api=e}getRequest(e){return a(this,null,function*(){return yield this.api.makeRequest("GET",e)})}postRequest(e,t,s=void 0){return a(this,null,function*(){return yield this.api.makeRequest("POST",e,t,s)})}putRequest(e,t,s=void 0){return a(this,null,function*(){return yield this.api.makeRequest("PUT",e,t,s)})}deleteRequest(e,t){return a(this,null,function*(){return yield this.api.makeRequest("DELETE",e,t)})}paramsFor(e){let t=new URLSearchParams;for(let s of Object.getOwnPropertyNames(e))(e[s]||e[s]===0||!e[s]&&typeof e[s]=="boolean")&&t.append(s,e[s].toString());return[...t].length>0?`?${t.toString()}`:""}};var S=class extends c{get(e,t){return a(this,null,function*(){if(typeof e=="string"){let o=this.paramsFor({market:t});return yield this.getRequest(`albums/${e}${o}`)}let s=this.paramsFor({ids:e,market:t});return(yield this.getRequest(`albums${s}`)).albums})}tracks(e,t,s,r){let o=this.paramsFor({market:t,limit:s,offset:r});return this.getRequest(`albums/${e}/tracks${o}`)}};var $=class extends c{get(e){return a(this,null,function*(){if(typeof e=="string")return this.getRequest(`artists/${e}`);let t=this.paramsFor({ids:e});return(yield this.getRequest(`artists${t}`)).artists})}albums(e,t,s,r,o){let n=this.paramsFor({include_groups:t,market:s,limit:r,offset:o});return this.getRequest(`artists/${e}/albums${n}`)}topTracks(e,t){let s=this.paramsFor({market:t});return this.getRequest(`artists/${e}/top-tracks${s}`)}relatedArtists(e){return this.getRequest(`artists/${e}/related-artists`)}};var q=class extends c{get(e,t){return a(this,null,function*(){if(typeof e=="string"){let o=this.paramsFor({market:t});return this.getRequest(`audiobooks/${e}${o}`)}let s=this.paramsFor({ids:e,market:t});return(yield this.getRequest(`audiobooks${s}`)).audiobooks})}getAudiobookChapters(e,t,s,r){let o=this.paramsFor({market:t,limit:s,offset:r});return this.getRequest(`audiobooks/${e}/chapters${o}`)}};var v=class extends c{getCategories(e,t,s,r){let o=this.paramsFor({country:e,locale:t,limit:s,offset:r});return this.getRequest(`browse/categories${o}`)}getCategory(e,t,s){let r=this.paramsFor({country:t,locale:s});return this.getRequest(`browse/categories/${e}${r}`)}getNewReleases(e,t,s){let r=this.paramsFor({country:e,limit:t,offset:s});return this.getRequest(`browse/new-releases${r}`)}getFeaturedPlaylists(e,t,s,r,o){let n=this.paramsFor({country:e,locale:t,timestamp:s,limit:r,offset:o});return this.getRequest(`browse/featured-playlists${n}`)}getPlaylistsForCategory(e,t,s,r){let o=this.paramsFor({country:t,limit:s,offset:r});return this.getRequest(`browse/categories/${e}/playlists${o}`)}};var F=class extends c{get(e,t){return a(this,null,function*(){if(typeof e=="string"){let o=this.paramsFor({market:t});return this.getRequest(`chapters/${e}${o}`)}let s=this.paramsFor({ids:e,market:t});return(yield this.getRequest(`chapters${s}`)).chapters})}};var A=class extends c{get(e,t){return a(this,null,function*(){if(typeof e=="string"){let o=this.paramsFor({market:t});return this.getRequest(`episodes/${e}${o}`)}let s=this.paramsFor({ids:e,market:t});return(yield this.getRequest(`episodes${s}`)).episodes})}};var P=class extends c{get(e){let t=this.paramsFor(e);return this.getRequest(`recommendations${t}`)}genreSeeds(){return this.getRequest("recommendations/available-genre-seeds")}};var I=class extends c{getAvailableMarkets(){return this.getRequest("markets")}};var E=class extends c{getPlaybackState(e,t){let s=this.paramsFor({market:e,additional_types:t});return this.getRequest(`me/player${s}`)}getAvailableDevices(){return this.getRequest("me/player/devices")}getCurrentlyPlayingTrack(e,t){let s=this.paramsFor({market:e,additional_types:t});return this.getRequest(`me/player/currently-playing${s}`)}getRecentlyPlayedTracks(e,t){let s={limit:e};t&&(t.type==="before"?s.before=t.timestamp:t.type==="after"&&(s.after=t.timestamp));let r=this.paramsFor(s);return this.getRequest(`me/player/recently-played${r}`)}getUsersQueue(){return this.getRequest("me/player/queue")}transferPlayback(e,t){return a(this,null,function*(){if(e.length>1)throw new Error("Although an array is accepted, only a single device_id is currently supported. Supplying more than one will return 400 Bad Request");yield this.putRequest("me/player",{device_ids:e,play:t})})}startResumePlayback(e,t,s,r,o){return a(this,null,function*(){let n=this.paramsFor({device_id:e});yield this.putRequest(`me/player/play${n}`,{context_uri:t,uris:s,offset:r,positionMs:o})})}pausePlayback(e){return a(this,null,function*(){let t=this.paramsFor({device_id:e});yield this.putRequest(`me/player/pause${t}`)})}skipToNext(e){return a(this,null,function*(){let t=this.paramsFor({device_id:e});yield this.postRequest(`me/player/next${t}`)})}skipToPrevious(e){return a(this,null,function*(){let t=this.paramsFor({device_id:e});yield this.postRequest(`me/player/previous${t}`)})}seekToPosition(e,t){return a(this,null,function*(){let s=this.paramsFor({position_ms:e,device_id:t});yield this.putRequest(`me/player/seek${s}`)})}setRepeatMode(e,t){return a(this,null,function*(){let s=this.paramsFor({state:e,device_id:t});yield this.putRequest(`me/player/repeat${s}`)})}setPlaybackVolume(e,t){return a(this,null,function*(){let s=this.paramsFor({volume_percent:e,device_id:t});yield this.putRequest(`me/player/volume${s}`)})}togglePlaybackShuffle(e,t){return a(this,null,function*(){let s=this.paramsFor({state:e,device_id:t});yield this.putRequest(`me/player/shuffle${s}`)})}addItemToPlaybackQueue(e,t){return a(this,null,function*(){let s=this.paramsFor({uri:e,device_id:t});yield this.postRequest(`me/player/queue${s}`)})}};var U=class extends c{getPlaylist(e,t,s,r){let o=this.paramsFor({market:t,fields:s,additional_types:r?.join(",")});return this.getRequest(`playlists/${e}${o}`)}getPlaylistItems(e,t,s,r,o,n){let p=this.paramsFor({market:t,fields:s,limit:r,offset:o,additional_types:n?.join(",")});return this.getRequest(`playlists/${e}/tracks${p}`)}changePlaylistDetails(e,t){return a(this,null,function*(){yield this.putRequest(`playlists/${e}`,t)})}movePlaylistItems(e,t,s,r){return this.updatePlaylistItems(e,{range_start:t,range_length:s,insert_before:r})}updatePlaylistItems(e,t){return this.putRequest(`playlists/${e}/tracks`,t)}addItemsToPlaylist(e,t,s){return a(this,null,function*(){yield this.postRequest(`playlists/${e}/tracks`,{position:s,uris:t})})}removeItemsFromPlaylist(e,t){return a(this,null,function*(){yield this.deleteRequest(`playlists/${e}/tracks`,t)})}getUsersPlaylists(e,t,s){let r=this.paramsFor({limit:t,offset:s});return this.getRequest(`users/${e}/playlists${r}`)}createPlaylist(e,t){return this.postRequest(`users/${e}/playlists`,t)}getPlaylistCoverImage(e){return this.getRequest(`playlists/${e}/images`)}addCustomPlaylistCoverImage(e,t){return a(this,null,function*(){let s="";if(t instanceof Buffer)s=t.toString("base64");else if(t instanceof HTMLCanvasElement)s=t.toDataURL("image/jpeg").split(";base64,")[1];else if(t instanceof HTMLImageElement){let r=document.createElement("canvas");r.width=t.width,r.height=t.height;let o=r.getContext("2d");if(!o)throw new Error("Could not get canvas context");o.drawImage(t,0,0),s=r.toDataURL("image/jpeg").split(";base64,")[1]}else if(typeof t=="string")s=t;else throw new Error("ImageData must be a Buffer, HTMLImageElement, HTMLCanvasElement, or string containing a base64 encoded jpeg");yield this.addCustomPlaylistCoverImageFromBase64String(e,s)})}addCustomPlaylistCoverImageFromBase64String(e,t){return a(this,null,function*(){yield this.putRequest(`playlists/${e}/images`,t,"image/jpeg")})}};var B=class extends c{execute(e,t,s,r,o,n){return a(this,null,function*(){let p=this.paramsFor({q:e,type:t,market:s,limit:r,offset:o,include_external:n});return yield this.getRequest(`search${p}`)})}};var L=class extends c{get(e,t){return a(this,null,function*(){if(typeof e=="string"){let o=this.paramsFor({market:t});return this.getRequest(`shows/${e}${o}`)}let s=this.paramsFor({ids:e,market:t});return(yield this.getRequest(`shows${s}`)).shows})}episodes(e,t,s,r){let o=this.paramsFor({market:t,limit:s,offset:r});return this.getRequest(`shows/${e}/episodes${o}`)}};var M=class extends c{get(e,t){return a(this,null,function*(){if(typeof e=="string"){let o=this.paramsFor({market:t});return this.getRequest(`tracks/${e}${o}`)}let s=this.paramsFor({ids:e,market:t});return(yield this.getRequest(`tracks${s}`)).tracks})}audioFeatures(e){return a(this,null,function*(){if(typeof e=="string")return this.getRequest(`audio-features/${e}`);let t=this.paramsFor({ids:e});return(yield this.getRequest(`audio-features${t}`)).audio_features})}audioAnalysis(e){return this.getRequest(`audio-analysis/${e}`)}};var y={access_token:"emptyAccessToken",token_type:"",expires_in:0,refresh_token:"",expires:-1};function m(i){return i===y}var j=class extends c{profile(e){return this.getRequest(`users/${e}`)}};var _=class extends c{albums;audiobooks;episodes;playlists;shows;tracks;constructor(e){super(e),this.albums=new G(e),this.audiobooks=new K(e),this.episodes=new Q(e),this.playlists=new Y(e),this.shows=new Z(e),this.tracks=new X(e)}profile(){return this.getRequest("me")}topItems(e,t,s,r){let o=this.paramsFor({time_range:t,limit:s,offset:r});return this.getRequest(`me/top/${e}${o}`)}followedArtists(e,t){let s=this.paramsFor({type:"artist",after:e,limit:t});return this.getRequest(`me/following${s}`)}followArtistsOrUsers(e,t){return a(this,null,function*(){let s=this.paramsFor({type:t});yield this.putRequest(`me/following${s}`,{ids:e})})}unfollowArtistsOrUsers(e,t){return a(this,null,function*(){let s=this.paramsFor({type:t});yield this.deleteRequest(`me/following${s}`,{ids:e})})}followsArtistsOrUsers(e,t){let s=this.paramsFor({ids:e,type:t});return this.getRequest(`me/following/contains${s}`)}};var G=class extends c{savedAlbums(e,t,s){let r=this.paramsFor({limit:e,offset:t,market:s});return this.getRequest(`me/albums${r}`)}saveAlbums(e){return a(this,null,function*(){yield this.putRequest("me/albums",e)})}removeSavedAlbums(e){return a(this,null,function*(){yield this.deleteRequest("me/albums",e)})}hasSavedAlbums(e){let t=this.paramsFor({ids:e});return this.getRequest(`me/albums/contains${t}`)}},K=class extends c{savedAudiobooks(e,t){let s=this.paramsFor({limit:e,offset:t});return this.getRequest(`me/audiobooks${s}`)}saveAudiobooks(e){return a(this,null,function*(){yield this.putRequest("me/audiobooks",e)})}removeSavedAudiobooks(e){return a(this,null,function*(){yield this.deleteRequest("me/audiobooks",e)})}hasSavedAudiobooks(e){let t=this.paramsFor({ids:e});return this.getRequest(`me/audiobooks/contains${t}`)}},Q=class extends c{savedEpisodes(e,t,s){let r=this.paramsFor({market:e,limit:t,offset:s});return this.getRequest(`me/episodes${r}`)}saveEpisodes(e){return a(this,null,function*(){yield this.putRequest("me/episodes",e)})}removeSavedEpisodes(e){return a(this,null,function*(){yield this.deleteRequest("me/episodes",e)})}hasSavedEpisodes(e){let t=this.paramsFor({ids:e});return this.getRequest(`me/episodes/contains${t}`)}},Y=class extends c{playlists(e,t){let s=this.paramsFor({limit:e,offset:t});return this.getRequest(`me/playlists${s}`)}follow(e){return a(this,null,function*(){yield this.putRequest(`playlists/${e}/followers`)})}unfollow(e){return a(this,null,function*(){yield this.deleteRequest(`playlists/${e}/followers`)})}isFollowing(e,t){let s=this.paramsFor({ids:t});return this.getRequest(`playlists/${e}/followers/contains${s}`)}},Z=class extends c{savedShows(e,t){let s=this.paramsFor({limit:e,offset:t});return this.getRequest(`me/shows${s}`)}saveShows(e){let t=this.paramsFor({ids:e});return this.putRequest(`me/shows${t}`)}removeSavedShows(e,t){let s=this.paramsFor({ids:e,market:t});return this.deleteRequest(`me/shows${s}`)}hasSavedShow(e){let t=this.paramsFor({ids:e});return this.getRequest(`me/shows/contains${t}`)}},X=class extends c{savedTracks(e,t,s){let r=this.paramsFor({limit:e,offset:t,market:s});return this.getRequest(`me/tracks${r}`)}saveTracks(e){return a(this,null,function*(){yield this.putRequest("me/tracks",e)})}removeSavedTracks(e){return a(this,null,function*(){yield this.deleteRequest("me/tracks",e)})}hasSavedTracks(e){let t=this.paramsFor({ids:e});return this.getRequest(`me/tracks/contains${t}`)}};var O=class{static get current(){return this.hasSubtleCrypto?window.crypto:this.tryLoadNodeWebCrypto()}static get hasSubtleCrypto(){return typeof window<"u"&&typeof window.crypto<"u"&&typeof window.crypto.subtle<"u"}static tryLoadNodeWebCrypto(){try{let{webcrypto:e}=we("crypto");return e}catch(e){throw e}}};var u=class i{static refreshCachedAccessToken(e,t){return a(this,null,function*(){let s=yield i.refreshToken(e,t.refresh_token);return i.toCachable(s)})}static toCachable(e){return e.expires&&e.expires===-1?e:T(h({},e),{expires:this.calculateExpiry(e)})}static calculateExpiry(e){return Date.now()+e.expires_in*1e3}static refreshToken(e,t){return a(this,null,function*(){let s=new URLSearchParams;s.append("client_id",e),s.append("grant_type","refresh_token"),s.append("refresh_token",t);let r=yield fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s}),o=yield r.text();if(!r.ok)throw new Error(`Failed to refresh token: ${r.statusText}, ${o}`);return JSON.parse(o)})}static generateCodeVerifier(e){let t="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<e;r++)t+=s.charAt(Math.floor(Math.random()*s.length));return t}static generateCodeChallenge(e){return a(this,null,function*(){let t=new TextEncoder().encode(e),s=yield O.current.subtle.digest("SHA-256",t),r=[...new Uint8Array(s)];return(typeof Buffer<"u"?Buffer.from(s).toString("base64"):btoa(String.fromCharCode.apply(null,r))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})}};var ee=(()=>{class i{clientId;clientSecret;scopes;static cacheKey="spotify-sdk:ClientCredentialsStrategy:token";configuration=null;get cache(){return this.configuration.cachingStrategy}constructor(t,s,r=[]){this.clientId=t,this.clientSecret=s,this.scopes=r}setConfiguration(t){this.configuration=t}getOrCreateAccessToken(){return a(this,null,function*(){return yield this.cache.getOrCreate(i.cacheKey,()=>a(this,null,function*(){let s=yield this.getTokenFromApi();return u.toCachable(s)}),s=>a(this,null,function*(){let r=yield this.getTokenFromApi();return u.toCachable(r)}))})}getAccessToken(){return a(this,null,function*(){return yield this.cache.get(i.cacheKey)})}removeAccessToken(){this.cache.remove(i.cacheKey)}getTokenFromApi(){return a(this,null,function*(){let t={grant_type:"client_credentials",scope:this.scopes.join(" ")},s=Object.keys(t).map(l=>l+"="+t[l]).join("&"),r=typeof Buffer<"u",o=`${this.clientId}:${this.clientSecret}`,n=r?Buffer.from(o).toString("base64"):btoa(o),p=yield fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${n}`},body:s});if(p.status!==200)throw new Error("Failed to get access token.");return yield p.json()})}}return i})();var ge=(()=>{class i{clientId;redirectUri;scopes;static cacheKey="spotify-sdk:ImplicitGrantStrategy:token";configuration=null;get cache(){return this.configuration.cachingStrategy}constructor(t,s,r){this.clientId=t,this.redirectUri=s,this.scopes=r}setConfiguration(t){this.configuration=t}getOrCreateAccessToken(){return a(this,null,function*(){return yield this.cache.getOrCreate(i.cacheKey,()=>a(this,null,function*(){let s=yield this.redirectOrVerifyToken();return u.toCachable(s)}),s=>a(this,null,function*(){return u.refreshCachedAccessToken(this.clientId,s)}))})}getAccessToken(){return a(this,null,function*(){return yield this.cache.get(i.cacheKey)})}removeAccessToken(){this.cache.remove(i.cacheKey)}redirectOrVerifyToken(){return a(this,null,function*(){let t=new URLSearchParams(window.location.hash.substring(1)),s=t.get("access_token");if(s)return Promise.resolve({access_token:s,token_type:t.get("token_type")??"",expires_in:parseInt(t.get("expires_in")??"0"),refresh_token:t.get("refresh_token")??"",expires:Number(t.get("expires"))||0});var o=(this.scopes??[]).join(" ");let n=new URLSearchParams;n.append("client_id",this.clientId),n.append("response_type","token"),n.append("redirect_uri",this.redirectUri),n.append("scope",o);let p="https://accounts.spotify.com/authorize?"+n.toString();return this.configuration.redirectionStrategy.redirect(p),y})}}return i})();var N=(()=>{class i{clientId;redirectUri;scopes;static cacheKey="spotify-sdk:AuthorizationCodeWithPKCEStrategy:token";configuration=null;get cache(){return this.configuration.cachingStrategy}constructor(t,s,r){this.clientId=t,this.redirectUri=s,this.scopes=r}setConfiguration(t){this.configuration=t}getOrCreateAccessToken(){return a(this,null,function*(){return yield this.cache.getOrCreate(i.cacheKey,()=>a(this,null,function*(){let s=yield this.redirectOrVerifyToken();return u.toCachable(s)}),s=>a(this,null,function*(){return u.refreshCachedAccessToken(this.clientId,s)}))})}getAccessToken(){return a(this,null,function*(){return yield this.cache.get(i.cacheKey)})}removeAccessToken(){this.cache.remove(i.cacheKey)}redirectOrVerifyToken(){return a(this,null,function*(){let s=new URLSearchParams(window.location.search).get("code");if(s){let r=yield this.verifyAndExchangeCode(s);return this.removeCodeFromUrl(),r}return this.redirectToSpotify(),y})}redirectToSpotify(){return a(this,null,function*(){let t=u.generateCodeVerifier(128),s=yield u.generateCodeChallenge(t),r={verifier:t,expiresOnAccess:!0};this.cache.setCacheItem("spotify-sdk:verifier",r);let o=yield this.generateRedirectUrlForUser(this.scopes,s);yield this.configuration.redirectionStrategy.redirect(o)})}verifyAndExchangeCode(t){return a(this,null,function*(){let r=(yield this.cache.get("spotify-sdk:verifier"))?.verifier;if(!r)throw new Error("No verifier found in cache - can't validate query string callback parameters.");return yield this.configuration.redirectionStrategy.onReturnFromRedirect(),yield this.exchangeCodeForToken(t,r)})}removeCodeFromUrl(){let t=new URL(window.location.href);t.searchParams.delete("code");let s=t.search?t.href:t.href.replace("?","");window.history.replaceState({},document.title,s)}generateRedirectUrlForUser(t,s){return a(this,null,function*(){let r=t.join(" "),o=new URLSearchParams;return o.append("client_id",this.clientId),o.append("response_type","code"),o.append("redirect_uri",this.redirectUri),o.append("scope",r),o.append("code_challenge_method","S256"),o.append("code_challenge",s),`https://accounts.spotify.com/authorize?${o.toString()}`})}exchangeCodeForToken(t,s){return a(this,null,function*(){let r=new URLSearchParams;r.append("client_id",this.clientId),r.append("grant_type","authorization_code"),r.append("code",t),r.append("redirect_uri",this.redirectUri),r.append("code_verifier",s);let o=yield fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r}),n=yield o.text();if(!o.ok)throw new Error(`Failed to exchange code for token: ${o.statusText}, ${n}`);return JSON.parse(n)})}}return i})();var g=class{deserialize(e){return a(this,null,function*(){let t=yield e.text();return t.length>0?JSON.parse(t):null})}};var w=class{validateResponse(e){return a(this,null,function*(){switch(e.status){case 401:throw new Error("Bad or expired token. This can happen if the user revoked a token or the access token has expired. You should re-authenticate the user.");case 403:let t=yield e.text();throw new Error(`Bad OAuth request (wrong consumer key, bad nonce, expired timestamp...). Unfortunately, re-authenticating the user won't help here. Body: ${t}`);case 429:throw new Error("The app has exceeded its rate limits.");default:if(!e.status.toString().startsWith("20")){let s=yield e.text();throw new Error(`Unrecognised response code: ${e.status} - ${e.statusText}. Body: ${s}`)}}})}};var k=class{handleErrors(e){return a(this,null,function*(){return!1})}};var R=class{redirect(e){return a(this,null,function*(){document.location=e.toString()})}onReturnFromRedirect(){return a(this,null,function*(){})}};var d=class{storage;updateFunctions;autoRenewInterval;autoRenewWindow;constructor(e,t=new Map,s=0,r=2*60*1e3){this.storage=e,this.updateFunctions=t,this.autoRenewInterval=s,this.autoRenewWindow=r,this.autoRenewInterval>0&&setInterval(()=>this.autoRenewRenewableItems(),this.autoRenewInterval)}getOrCreate(e,t,s){return a(this,null,function*(){s&&this.updateFunctions.set(e,s);let r=yield this.get(e);if(r)return r;let o=yield t();if(!o)throw new Error("Could not create cache item");return m(o)||this.setCacheItem(e,o),o})}get(e){return a(this,null,function*(){let t=this.storage.get(e),s=t?JSON.parse(t):null;if(this.itemDueToExpire(s)&&this.updateFunctions.has(e)){let r=this.updateFunctions.get(e);yield this.tryUpdateItem(e,s,r),t=this.storage.get(e),s=t?JSON.parse(t):null}return s?s.expires&&(s.expires===-1||s.expires<=Date.now())?(this.remove(e),null):(s.expiresOnAccess&&s.expiresOnAccess===!0&&this.remove(e),s):null})}set(e,t,s){let r=Date.now()+s,o=T(h({},t),{expires:r});this.setCacheItem(e,o)}setCacheItem(e,t){let s=JSON.stringify(t);this.storage.set(e,s)}remove(e){this.storage.remove(e)}itemDueToExpire(e){return!e||!e.expires?!1:e.expires-Date.now()<this.autoRenewWindow}autoRenewRenewableItems(){return a(this,null,function*(){this.updateFunctions.forEach((e,t)=>a(this,null,function*(){let s=yield this.get(t);s&&e&&this.itemDueToExpire(s)&&(yield this.tryUpdateItem(t,s,e))}))})}tryUpdateItem(e,t,s){return a(this,null,function*(){try{let r=yield s(t);r&&this.setCacheItem(e,r)}catch(r){console.error(r)}})}};var b=class extends d{constructor(){super(new te)}};var te=class{get(e){return localStorage.getItem(e)}set(e,t){localStorage.setItem(e,t)}remove(e){localStorage.removeItem(e)}};var x=class extends d{constructor(){super(new se)}};var se=class{cache=new Map;get(e){return this.cache.get(e)??null}set(e,t){this.cache.set(e,t)}remove(e){this.cache.delete(e)}};var z=class{clientId;accessToken;refreshTokenAction;constructor(e,t,s){this.clientId=e,this.accessToken=t,this.refreshTokenAction=s||u.refreshCachedAccessToken,this.accessToken.expires||(this.accessToken.expires=u.calculateExpiry(this.accessToken))}setConfiguration(e){}getOrCreateAccessToken(){return a(this,null,function*(){if(this.accessToken.expires&&this.accessToken.expires<=Date.now()){let e=yield this.refreshTokenAction(this.clientId,this.accessToken);this.accessToken=e}return this.accessToken})}getAccessToken(){return a(this,null,function*(){return this.accessToken})}removeAccessToken(){this.accessToken={access_token:"",token_type:"",expires_in:0,refresh_token:"",expires:0}}};var re=(()=>{class i{sdkConfig;static rootUrl="https://api.spotify.com/v1/";authenticationStrategy;albums;artists;audiobooks;browse;chapters;episodes;recommendations;markets;player;playlists;shows;tracks;users;search;currentUser;constructor(t,s){this.sdkConfig=this.initializeSdk(s),this.albums=new S(this),this.artists=new $(this),this.audiobooks=new q(this),this.browse=new v(this),this.chapters=new F(this),this.episodes=new A(this),this.recommendations=new P(this),this.markets=new I(this),this.player=new E(this),this.playlists=new U(this),this.shows=new L(this),this.tracks=new M(this),this.users=new j(this),this.currentUser=new _(this);let r=new B(this);this.search=r.execute.bind(r),this.authenticationStrategy=t,this.authenticationStrategy.setConfiguration(this.sdkConfig)}makeRequest(t,s,r=void 0,o=void 0){return a(this,null,function*(){try{let n=yield this.authenticationStrategy.getOrCreateAccessToken();if(m(n))return console.warn("No access token found, authenticating now."),null;let p=n?.access_token,f=i.rootUrl+s,l={method:t,headers:{Authorization:`Bearer ${p}`,"Content-Type":o??"application/json"},body:r?typeof r=="string"?r:JSON.stringify(r):void 0};this.sdkConfig.beforeRequest(f,l);let C=yield this.sdkConfig.fetch(f,l);return this.sdkConfig.afterRequest(f,l,C),C.status===204?null:(yield this.sdkConfig.responseValidator.validateResponse(C),this.sdkConfig.deserializer.deserialize(C))}catch(n){if(!(yield this.sdkConfig.errorHandler.handleErrors(n)))throw n;return null}})}initializeSdk(t){let s=typeof window<"u",r={fetch:(o,n)=>fetch(o,n),beforeRequest:(o,n)=>{},afterRequest:(o,n,p)=>{},deserializer:new g,responseValidator:new w,errorHandler:new k,redirectionStrategy:new R,cachingStrategy:s?new b:new x};return h(h({},r),t)}switchAuthenticationStrategy(t){this.authenticationStrategy=t,this.authenticationStrategy.setConfiguration(this.sdkConfig),this.authenticationStrategy.getOrCreateAccessToken()}authenticate(){return a(this,null,function*(){let t=yield this.authenticationStrategy.getOrCreateAccessToken();return{authenticated:t.expires>Date.now()&&!m(t),accessToken:t}})}getAccessToken(){return a(this,null,function*(){return this.authenticationStrategy.getAccessToken()})}logOut(){this.authenticationStrategy.removeAccessToken()}static withUserAuthorization(t,s,r=[],o){let n=new N(t,s,r);return new i(n,o)}static withClientCredentials(t,s,r=[],o){let n=new ee(t,s,r);return new i(n,o)}static withImplicitGrant(t,s,r=[],o){let n=new ge(t,s,r);return new i(n,o)}static withAccessToken(t,s,r){let o=new z(t,s);return new i(o,r)}static performUserAuthorization(t,s,r,o,n){return a(this,null,function*(){let p=new N(t,s,r),l=yield new i(p,n).authenticationStrategy.getOrCreateAccessToken();return m(l)||(typeof o=="string"?(console.log("Posting access token to postback URL."),yield fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})):yield o(l)),{authenticated:l.expires>Date.now()&&!m(l),accessToken:l}})}}return i})();var zs=(()=>{let e=class e{constructor(){this.clientId="cffd066e684f4b0f826e746e4d693f5a",this.redirectUri=`${window.location.origin}/callback`,this.scope=["playlist-modify-private","playlist-modify-public","playlist-read-collaborative","playlist-read-private","streaming","ugc-image-upload","user-follow-modify","user-follow-read","user-library-modify","user-library-read","user-modify-playback-state","user-read-currently-playing","user-read-email","user-read-playback-position","user-read-playback-state","user-read-private","user-read-recently-played","user-top-read"],this.SA=re.withUserAuthorization(this.clientId,this.redirectUri,this.scope)}login(){return a(this,null,function*(){yield this.SA.currentUser.profile()})}getUser(){return a(this,null,function*(){return this.SA||this.login(),this.user||this.setUser(),this.user})}setUser(){return a(this,null,function*(){if(this.user=yield this.SA.currentUser.profile(),!this.user)throw new Error("unable to fetch user.")})}fetchMyPlaylists(s=0){return a(this,null,function*(){return yield this.SA.currentUser.playlists.playlists(50,s)})}deletePlaylist(s){return a(this,null,function*(){yield this.SA.currentUser.playlists.unfollow(s)})}getPlaylist(s){return a(this,null,function*(){return yield this.SA.playlists.getPlaylist(s)})}getAllPlaylistItems(s,r){return a(this,null,function*(){let o=[],n=Math.ceil(r/50),p=[];for(let l=0;l<n;l++)p.push(this.SA.playlists.getPlaylistItems(s,void 0,void 0,50,l*50));return(yield Promise.all(p)).forEach(l=>{o.push(...l.items)}),o})}getUserLikedItems(){return a(this,null,function*(){let s=[],r=0;do{let o=yield this.SA.currentUser.tracks.savedTracks(50,s.length,void 0);r=o.total,s.push(...o.items)}while(s.length<r);return s})}removeSongFromPlaylist(s,r){return a(this,null,function*(){if(r.length===0)return!1;let o=r.map(D=>({uri:D})),n=J(o,100);try{for(var p=V(n),f,l,C;f=!(l=yield p.next()).done;f=!1){let D=l.value;yield this.SA.playlists.removeItemsFromPlaylist(s,{tracks:D})}}catch{C=[l]}finally{try{f&&(l=p.return)&&(yield l.call(p))}finally{if(C)throw C[0]}}return!0})}getArtists(s){return a(this,null,function*(){let r=[],o=J(s,50),n=[];try{for(var f=V(o),l,C,D;l=!(C=yield f.next()).done;l=!1){let H=C.value;n.push(this.SA.artists.get(H))}}catch{D=[C]}finally{try{l&&(C=f.return)&&(yield C.call(f))}finally{if(D)throw D[0]}}return(yield Promise.all(n)).forEach(H=>{r.push(...H)}),console.log("totalArr",r),r})}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Js=(()=>{class i extends ye{static \u0275fac=(()=>{let t;return function(r){return(t||(t=ne(i)))(r||i)}})();static \u0275cmp=oe({type:i,selectors:[["TimesIcon"]],standalone:!0,features:[pe,fe],decls:2,vars:5,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M8.01186 7.00933L12.27 2.75116C12.341 2.68501 12.398 2.60524 12.4375 2.51661C12.4769 2.42798 12.4982 2.3323 12.4999 2.23529C12.5016 2.13827 12.4838 2.0419 12.4474 1.95194C12.4111 1.86197 12.357 1.78024 12.2884 1.71163C12.2198 1.64302 12.138 1.58893 12.0481 1.55259C11.9581 1.51625 11.8617 1.4984 11.7647 1.50011C11.6677 1.50182 11.572 1.52306 11.4834 1.56255C11.3948 1.60204 11.315 1.65898 11.2488 1.72997L6.99067 5.98814L2.7325 1.72997C2.59553 1.60234 2.41437 1.53286 2.22718 1.53616C2.03999 1.53946 1.8614 1.61529 1.72901 1.74767C1.59663 1.88006 1.5208 2.05865 1.5175 2.24584C1.5142 2.43303 1.58368 2.61419 1.71131 2.75116L5.96948 7.00933L1.71131 11.2675C1.576 11.403 1.5 11.5866 1.5 11.7781C1.5 11.9696 1.576 12.1532 1.71131 12.2887C1.84679 12.424 2.03043 12.5 2.2219 12.5C2.41338 12.5 2.59702 12.424 2.7325 12.2887L6.99067 8.03052L11.2488 12.2887C11.3843 12.424 11.568 12.5 11.7594 12.5C11.9509 12.5 12.1346 12.424 12.27 12.2887C12.4053 12.1532 12.4813 11.9696 12.4813 11.7781C12.4813 11.5866 12.4053 11.403 12.27 11.2675L8.01186 7.00933Z","fill","currentColor"]],template:function(s,r){s&1&&(ie(),he(0,"svg",0),de(1,"path",1),me()),s&2&&(ue(r.getClassNames()),le("aria-label",r.ariaLabel)("aria-hidden",r.ariaHidden)("role",r.role))},encapsulation:2})}return i})();export{be as a,xe as b,Js as c,zs as d};
